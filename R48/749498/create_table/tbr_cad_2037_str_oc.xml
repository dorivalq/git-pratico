<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

	<changeSet author="fabiofernandes81" id="1">
        <createTable remarks="Cadastro das Ocorrências do Setor/Lotação do eSocial." 
        	tableName="TBR_CAD_2037_STR_OC">
        	
        	<column name="IDT_STR_OC" remarks="Identificador único da Ocorrência do setor/lotação." type="NUMBER(22)">
                <constraints nullable="false"/>
            </column>
            
            <column name="IDT_SECTOR" remarks="Identificador único do setor/lotação." type="NUMBER(22)">
                <constraints nullable="false"/>
            </column>
            
            <column name="DAT_OCCURENCE" type="DATE">
                <constraints nullable="false"/>
            </column>

            <column name="IND_LAYOUT_ESOCIAL" remarks="Informação de Controle.   Indicador utilizado para sinalizar que o layout  utilizado na integração foi o XML formato eSOCIAL. Preenchido com  S - Layout eSocial.N ou nulo - Layout Thomson Reuters; Domínio DM_SIM_NAO." type="CHAR(1)"/>                        

            <column name="COD_OPER" remarks="Informação de Controle.Indicador da operação proveniente do layout eSocial.  Preenchido com : I - Inclusão;A - Alteração;E - Exclusão; IA - Inclusão ou Alteração; Domínio DM_TIPO_OPERACAO_INTEGRACAO. " type="VARCHAR2(2)"/>
                
            <column name="COD_ID_EVENT" remarks="Identificador único do Evento eSocial (id)" type="VARCHAR2(36)"/>
                
            <column name="COD_EVENT" remarks="Código do Evento eSocial . Ex: S-1000, S-1020, etc" type="VARCHAR2(36)"/>
                
            <column name="IND_ENVIRONMENT" remarks="Identificação do ambiente (tpAmb): 1 - Produção; 2 - Pré-produção - dados reais; 3 - Pré-produção - dados fictícios. Domínio DM_EFD_EVENTO_TIPO_AMBIENTE." type="CHAR(1)"/>
                
            <column name="IND_PRC_EMI" remarks="Processo de emissão do evento eSocial (prcEmi) 1- Emissão com aplicativo do empregador Domínio DM_EFD_EVENTO_PROCESSO_EMISSAO." type="CHAR(1)"/>
                
            <column name="COD_VS_PROC" remarks="Versão do Processo emissor do evento eSocial (verProc)" type="VARCHAR2(20)"/>                

            <column name="IND_OC_EVT" remarks="Indicador de Ocorrência ou Evento: O - Ocorrência E - Evento" type="CHAR(1)"/>                            
            <column name="IND_STATUS" remarks="Indicador do Status" type="CHAR(1)"/>
                
            <column name="DAT_INSERT_UPDATE" remarks="Data Início Validade do cadastro" type="DATE">
                <constraints nullable="false"/>
            </column>

            <column name="DAT_END_EFFECTIVE" remarks="Data Fim Validade do cadastro" type="DATE"/>
                
            <column name="DAT_INSERT_UPDATE_NEW" remarks="Nova Data Início de Validade" type="DATE"/>
                
            <column name="DAT_END_EFFECTIVE_NEW" remarks="Nova Data Fim de Validade" type="DATE"/>
                
            <column name="COD_SECTOR_TYPE" remarks="Código do tipo da lotação conforme lista de referência FXD00033 Este campo pode ser preenchido com código registrado no sistema de origem, com uso da funcionalidade de DexPara do TAX-BR " type="VARCHAR2(50)"/>
                
            <column name="COD_REGISTRATION_TYPE" remarks="Código do tipo de inscrição do estabelecimento, que poderá assumir os valores 1, 2, 4. Este campo pode ser preenchido com código registrado no sistema de origem, com uso da funcionalidade de DexPara." type="VARCHAR2(50)"/>                

            <column name="NUM_REGISTRATION" remarks="Número de inscrição do estabelecimento ao qual a lotação está vinculada." type="VARCHAR2(15)"/>
                
            <column name="COD_SOCIAL_SEC_FUND" remarks="Código do FPAS. Llista de referência FXD00035.-- Este campo pode ser preenchido com código registrado no sistema de origem, com o uso da funcionalidade de DexPara. " type="VARCHAR2(50)"/>
                
            <column name="COD_THIRD_PARTY" remarks="Código de Terceiros, conforme tabela FXD00035. Este campo pode ser preenchido com código registrado no sistema de origem, com o uso da funcionalidade de DexPara do TAX-BR," type="VARCHAR2(50)"/>
                
            <column name="IND_HIRER_REGISTRATION" remarks="Tipo de Inscrição do contratante: 1 - CNPJ; 2 - CPF." type="CHAR(1)"/>
                
            <column name="NUM_HIRER_REGISTRATION" remarks="Número de inscrição do contratante da obra." type="VARCHAR2(14)"/>
                
            <column name="IND_OWNER_REGISTRATION" remarks="Tipo de Inscrição do proprietário do CNO. 1 - CNPJ; 2 - CPF." type="CHAR(1)"/>
                
            <column name="NUM_OWNER_REGISTRATION" remarks="Número de Inscrição do proprietário do CNO." type="VARCHAR2(14)"/>
                
            <column name="IDT_UPPER_LVL_STR" remarks="Identificador da Ocorrência de Nível Superior" type="NUMBER(22)"/>
                            
            <!-- Framework -->
            <column name="D_LAST_UPDATE_DATE" remarks="Data da última atualização. Campo utilizado pela framework de aplicação de regras de negócio de validação." type="DATE">
            </column>
            <column name="S_LAST_UPDATE_BY" remarks="Responsável pela última atualização. Campo utilizado pela framework de aplicação de regras de negócio de validação." type="VARCHAR2(250)">
            </column>
            <column name="D_CREATION_DATE" remarks="Data da criação do registro. Campo utilizado pela framework de aplicação de regras de negócio de validação." type="DATE">
            </column>
            <column name="S_CREATED_BY" remarks="Criado por. Campo utilizado pela framework de aplicação de regras de negócio de validação." type="VARCHAR2(250)">
            </column>
        </createTable>        
    </changeSet>
	
    <changeSet author="fabiofernandes81" id="2">
        <addUniqueConstraint columnNames="IDT_SECTOR, DAT_OCCURENCE" constraintName="UK_TBR_CAD_2037_STR_OC_001" tableName="TBR_CAD_2037_STR_OC"/>        
    </changeSet>
	
    <changeSet author="fabiofernandes81" id="3">
        <addPrimaryKey columnNames="IDT_STR_OC" constraintName="PK_TBR_CAD_2037_STR_OC" tableName="TBR_CAD_2037_STR_OC"/>
    </changeSet>    

    <changeSet author="fabiofernandes81" id="4">
        <addForeignKeyConstraint baseColumnNames="IDT_SECTOR" baseTableName="TBR_CAD_2037_STR_OC" constraintName="FK_TBR_CAD_2037_STR_OC_001"  
        						 referencedColumnNames="IDT_SECTOR" referencedTableName="TBR_CAD_2037_SECTOR"/>
    </changeSet>    

    <changeSet author="fabiofernandes81" id="5">
        <addForeignKeyConstraint baseColumnNames="IDT_UPPER_LVL_STR" baseTableName="TBR_CAD_2037_STR_OC" constraintName="FK_TBR_CAD_2037_STR_OC_002"  
                                 referencedColumnNames="IDT_STR_OC" referencedTableName="TBR_CAD_2037_STR_OC"/>
    </changeSet>    
</databaseChangeLog>   